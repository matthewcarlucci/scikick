
```{r init}
pathCase <- "output/analysis_normalization/saveData_dCaseN_rmRowEffect.RDS"
pathCtrl <- "output/analysis_normalization/saveData_dCtrlN_rmRowEffect.RDS"

lmHRmat <- function (x, zts, per = 24) {
    Y <- as.matrix(x)
    x1 <- sin(2 * pi * zts/per)
    x2 <- cos(2 * pi * zts/per)
    x0 <- rep(1, dim(Y)[2])
    X <- cbind(x0, x1, x2)
    betas <- solve(t(X) %*% X) %*% t(X) %*% t(Y)
    acrophases <- sincos2acr(betas[2, ], betas[3, ], per)
    amplitudes <- sincos2amp(betas[2, ], betas[3, ])
    fits <- t(X %*% betas)
    SStot <- rowSums((Y - rowMeans(Y))^2)
    SSres <- rowSums((fits - Y)^2)
    Rsqs <- 1 - (SSres/SStot)
    SSmod <- SStot - SSres
    DFres <- ncol(x) - 3
    DFmod <- 2
    MSres <- SSres/DFres
    MSmod <- SSmod/DFmod
    Fstatistic <- MSmod/MSres
    pval <- pf(Fstatistic, DFmod, DFres, lower.tail = FALSE)
    data.frame(acrophase = acrophases, amplitude = amplitudes, 
        Rsq = Rsqs, pvalue = pval, intercept = betas[1, ], sincoef = betas[2, 
            ], coscoef = betas[3, ])
}
sincos2acr <- function (sin, cos, per = 24) {
    (atan2(sin, cos)/2/pi * per + per)%%per
} 
sincos2amp <- function (sin, cos, per = 24) {
    2 * sqrt(sin^2 + cos^2)
} 
plotHist <- function(input, main, xlab, ylab = "Frequency", brk = 100) {
    hist(input, breaks = brk, main = main, xlab = xlab, ylab = ylab)
}

dCase <- readRDS(pathCase)
dCtrl <- readRDS(pathCtrl)
```


### P values {.tabset}

```{r HR}
resCase <- lmHRmat(dCase, as.numeric(gsub(".*_", "", colnames(dCase))))
resCtrl <- lmHRmat(dCtrl, as.numeric(gsub(".*_", "", colnames(dCtrl))))
```


#### Case
```{r}
plotHist(resCase$pvalue, "Case", xlab = "P values")
```

#### Control
```{r}
plotHist(resCtrl$pvalue, "Control", xlab = "P values")
```

### Metadata
